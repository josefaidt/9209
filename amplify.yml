version: 1
backend:
  phases:
    preBuild:
      commands:
        - nvm install
        - if ! [ -x "$(command -v jq)" ]; then yum install jq -y; fi;
        - AMPLIFY_PLUGINS_FILE=~/.amplify/plugins.json
        - content="$(jq '.pluginDirectories += ["packaged-node-modules"]' $AMPLIFY_PLUGINS_FILE)" && \
          echo "${content}" > $AMPLIFY_PLUGINS_FILE
        - yarn global add @aws-amplify/cli
    build:
      commands:
        - amplifyPush --simple
